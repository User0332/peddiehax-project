<!DOCTYPE html>

<html>
	<head>
		<title>My Journey</title>

		<script 
			src="https://www.unpkg.com/@propelauth/javascript@2.0.11/dist/javascript.min.js" 
			integrity="sha384-FENNH2f7QuQvkZJBL7jebLr0OtYKgTA2iq+C5g3VXXX7SBwWmeMMoc+pBBtcn76G" 
			crossorigin="anonymous"></script>
		<script src="/static/js/authuser.js"></script>
		<script src="/static/js/api.js"></script>
		<script src="/static/js/navbar.js" defer></script>
		<script src="/static/js/elemutils.js" defer></script>

		<link rel="stylesheet" href="/static/css/theme.css"/>
		<link rel="stylesheet" href="/static/css/view-journey.css"/>

	</head>

	<body>
		<script>
			const journeyID = new URLSearchParams(location.search).get("id")

			let globalAuthInfo;

			execWithUserData(async (userData, authInfo) => { // main function for page
				globalAuthInfo = authInfo;

				const journeyInfo = await getJourneyInfo(journeyID, authInfo)

				const journeyMessage = document.createElement("h2")
			
				const greeting = document.createElement("h1")

				greeting.textContent = `Hey, ${authInfo.user.firstName}`;

				document.body.prepend(
					greeting,
					journeyMessage
				);

				const entriesContainer = document.getElementById("entries-container");

				let totalRatingPts = 0;

				for (const entryID of journeyInfo.entries) {
					const entryInfo = await getEntryInfo(entryID, authInfo);

					const entrySummaryContainer = document.createElement("div");
					
					entrySummaryContainer.className = "entry-summary"

					entrySummaryContainer.append(
						textElement("h2", entryInfo.name)
					);

					if (entryInfo.people) entrySummaryContainer.append(
						textElement("h3", `With ${entryInfo.people.join(", ")}`)
					)

					entrySummaryContainer.append(
						textElement('p', entryInfo.description)
					);

					entrySummaryContainer.append(
						textElement("h3", `You rated: ${entryInfo.rating} \u2605`)
					);
					var a = document.createElement('a')
					a.href = `/view-entry?entryID=${entryID}`;
		
					a.text = "view imgs"

					entrySummaryContainer.append(a)

					entriesContainer.append(entrySummaryContainer);

					totalRatingPts+=entryInfo.rating;
				}

				let overallRating = (totalRatingPts/journeyInfo.entries.length).toFixed(1);

				if (overallRating == "NaN") overallRating = "?"

				journeyMessage.textContent = `Welcome to your journey "${journeyInfo.name}" (${overallRating} \u2605)`
			})
		</script>

		<div id="entries-container">

		</div>



		<a href="" onclick="location.href = `/new-entry?journeyID=${journeyID}`; return false" class="anchor-btn" id="new-entry-btn">Add a New Entry &#x2192;</a>

	</body>
</html>