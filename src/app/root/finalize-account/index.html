<!DOCTYPE html>

<html>
	<head>
		<title>Create Account</title>

		<script 
			src="https://www.unpkg.com/@propelauth/javascript@2.0.11/dist/javascript.min.js" 
			integrity="sha384-FENNH2f7QuQvkZJBL7jebLr0OtYKgTA2iq+C5g3VXXX7SBwWmeMMoc+pBBtcn76G" 
			crossorigin="anonymous"></script>
		<script src="/static/js/authuser.js"></script>

	</head>

	<body>
		<script>
			let globalAuthInfo;

			getAuthInfo().then(
				authInfo => {
					globalAuthInfo = authInfo;

					fetch(
						"/api/getself", {
							"headers": {
								Authorization: `Bearer ${authInfo.accessToken}`
							}
						}
					)
				}
			).then(
				res => res.json()
			).then(
				userData => { // main function for page
					if (userData) location.href = "/dashboard" // disallow multiple-time account creation
				}
			)

			function createAccount() {
				const userName = document.getElementById("userNameInput").value;

				if (!userName) {
					alert("You must enter a username!") // TODO: more alphanum validation
					return
				}

				fetch(`/api/createaccount?username=${userName}`, {
					"headers": {
						Authorization: `Bearer ${globalAuthInfo.accessToken}`
					}
				}).then(
					resp => location.href = "/dashboard"
				)
			}
		</script>

		<h1>Enter a Username: </h1>
		<input type="text" id="userNameInput"/>
		<button onclick="createAccount()">Finish Account Creation</button>
	</body>
</html>